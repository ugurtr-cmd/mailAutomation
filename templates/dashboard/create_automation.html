{% extends 'base.html' %}
{% load static %}

{% block title %}Yeni Otomasyon - EmailOtomasyon{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center py-4">
    <div class="d-block mb-4 mb-md-0">
        <h2 class="h4">Yeni Otomasyon</h2>
        <p class="mb-0">Otomatik e-posta serisi oluÅŸturun</p>
    </div>
</div>

<div class="row">
    <div class="col-12 col-lg-8">
        <div class="card border-0 shadow">
            <div class="card-body">
                <form method="post" id="automationForm">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <h6 class="mb-3">Temel Bilgiler</h6>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="{{ form.name.id_for_label }}" class="form-label">Otomasyon AdÄ±</label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                <div class="text-danger small">{{ form.name.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="{{ form.description.id_for_label }}" class="form-label">AÃ§Ä±klama</label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                <div class="text-danger small">{{ form.description.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">Tetikleyici AyarlarÄ±</h6>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="{{ form.trigger_type.id_for_label }}" class="form-label">Tetikleyici TÃ¼rÃ¼</label>
                                {{ form.trigger_type }}
                                {% if form.trigger_type.errors %}
                                <div class="text-danger small">{{ form.trigger_type.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="{{ form.mail_list.id_for_label }}" class="form-label">Hedef Liste</label>
                                {{ form.mail_list }}
                                {% if form.mail_list.errors %}
                                <div class="text-danger small">{{ form.mail_list.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div id="triggerConfigSection" style="display: none;">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="{{ form.trigger_config.id_for_label }}" class="form-label">Tetikleyici AyarlarÄ±</label>
                                    {{ form.trigger_config }}
                                    <div class="form-text">JSON formatÄ±nda tetikleyici Ã¶zelleÅŸtirmeleri</div>
                                    {% if form.trigger_config.errors %}
                                    <div class="text-danger small">{{ form.trigger_config.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">Zamanlama AyarlarÄ±</h6>
                        <div class="row">
                            <div class="col-12 col-md-6 mb-3">
                                <label for="{{ form.delay_minutes.id_for_label }}" class="form-label">BaÅŸlangÄ±Ã§ Gecikmesi (dakika)</label>
                                {{ form.delay_minutes }}
                                <div class="form-text">Tetiklenmeden kaÃ§ dakika sonra baÅŸlasÄ±n</div>
                                {% if form.delay_minutes.errors %}
                                <div class="text-danger small">{{ form.delay_minutes.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label for="{{ form.interval_minutes.id_for_label }}" class="form-label">GÃ¶nderim AralÄ±ÄŸÄ± (dakika)</label>
                                {{ form.interval_minutes }}
                                <div class="form-text">E-postalar arasÄ±ndaki sÃ¼re</div>
                                {% if form.interval_minutes.errors %}
                                <div class="text-danger small">{{ form.interval_minutes.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'automations' %}" class="btn btn-secondary me-md-2">Ä°ptal</a>
                        <button type="submit" class="btn btn-primary">Otomasyonu OluÅŸtur</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow">
            <div class="card-header">
                <h5 class="card-title mb-0">Tetikleyici TÃ¼rleri</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-success">ðŸ“¥ Abonelik</h6>
                    <p class="small text-muted mb-2">Yeni abone olduÄŸunda tetiklenir</p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-primary">ðŸ“… Tarih</h6>
                    <p class="small text-muted mb-2">Belirli tarihte tetiklenir</p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-info">ðŸŽ¯ DavranÄ±ÅŸ</h6>
                    <p class="small text-muted mb-2">Belirli eylemlerde tetiklenir</p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-warning">ðŸ”— Webhook</h6>
                    <p class="small text-muted mb-2">DÄ±ÅŸ sistemlerden tetiklenir</p>
                </div>
            </div>
        </div>
        
        <div class="card border-0 shadow mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Ã–rnek Otomasyonlar</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-primary">HoÅŸ Geldin Serisi</h6>
                    <p class="small text-muted mb-2">
                        <strong>Tetikleyici:</strong> Abonelik<br>
                        <strong>AdÄ±mlar:</strong> 3 e-posta<br>
                        <strong>SÃ¼re:</strong> 7 gÃ¼n
                    </p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-success">SatÄ±ÅŸ SonrasÄ± Takip</h6>
                    <p class="small text-muted mb-2">
                        <strong>Tetikleyici:</strong> SatÄ±n alma<br>
                        <strong>AdÄ±mlar:</strong> 5 e-posta<br>
                        <strong>SÃ¼re:</strong> 30 gÃ¼n
                    </p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-warning">Terk Sepet HatÄ±rlatma</h6>
                    <p class="small text-muted mb-2">
                        <strong>Tetikleyici:</strong> Sepet terk<br>
                        <strong>AdÄ±mlar:</strong> 3 e-posta<br>
                        <strong>SÃ¼re:</strong> 3 gÃ¼n
                    </p>
                </div>
            </div>
        </div>
        
        <div class="card border-0 shadow mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Ä°puÃ§larÄ±</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Tetikleyiciyi dikkatli seÃ§in
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        ZamanlamayÄ± kullanÄ±cÄ± deneyimine gÃ¶re ayarlayÄ±n
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Ã‡ok sÄ±k gÃ¶nderim yapmaktan kaÃ§Ä±nÄ±n
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Otomasyonu test etmeyi unutmayÄ±n
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
// Tetikleyici tÃ¼rÃ¼ne gÃ¶re ayar bÃ¶lÃ¼mÃ¼nÃ¼ gÃ¶ster/gizle
document.getElementById('{{ form.trigger_type.id_for_label }}').addEventListener('change', function() {
    const triggerConfigSection = document.getElementById('triggerConfigSection');
    if (this.value !== 'subscription') {
        triggerConfigSection.style.display = 'block';
    } else {
        triggerConfigSection.style.display = 'none';
    }
});

// Sayfa yÃ¼klendiÄŸinde tetikle
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('{{ form.trigger_type.id_for_label }}').dispatchEvent(new Event('change'));
});
</script>
{% endblock %}
{% endblock %}