{% extends 'base.html' %}
{% load static %}

{% block title %}Abone İçe Aktar - EmailOtomasyon{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center py-4">
    <div class="d-block mb-4 mb-md-0">
        <h2 class="h4">Abone İçe Aktar</h2>
        <p class="mb-0">{{ mail_list.name }} listesine CSV dosyasından abone ekleyin</p>
    </div>
</div>

<div class="row">
    <div class="col-12 col-lg-8">
        <div class="card border-0 shadow">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="importForm">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <h6 class="mb-3">1. CSV Dosyasını Seçin</h6>
                        <div class="mb-3">
                            <label for="{{ csv_form.csv_file.id_for_label }}" class="form-label">CSV Dosyası</label>
                            {{ csv_form.csv_file }}
                            {% if csv_form.csv_file.errors %}
                            <div class="text-danger small">{{ csv_form.csv_file.errors }}</div>
                            {% endif %}
                            <div class="form-text">Maksimum dosya boyutu: 5MB. Desteklenen format: CSV</div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="form-check">
                                    {{ csv_form.has_headers }}
                                    <label class="form-check-label" for="{{ csv_form.has_headers.id_for_label }}">
                                        Dosyada başlık satırı var
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">2. Sütun Eşleştirme</h6>
                        <div class="row">
                            <div class="col-12 col-md-6 mb-3">
                                <label for="{{ csv_form.email_column.id_for_label }}" class="form-label">E-posta Sütunu</label>
                                {{ csv_form.email_column }}
                                {% if csv_form.email_column.errors %}
                                <div class="text-danger small">{{ csv_form.email_column.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label for="{{ csv_form.name_column.id_for_label }}" class="form-label">İsim Sütunu</label>
                                {{ csv_form.name_column }}
                                {% if csv_form.name_column.errors %}
                                <div class="text-danger small">{{ csv_form.name_column.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">3. İşlem Seçenekleri</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="import_option" id="option1" value="add" checked>
                            <label class="form-check-label" for="option1">
                                Sadece yeni aboneleri ekle
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="import_option" id="option2" value="update">
                            <label class="form-check-label" for="option2">
                                Mevcut aboneleri güncelle, yeni aboneleri ekle
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="import_option" id="option3" value="replace">
                            <label class="form-check-label" for="option3">
                                Tüm listeyi yenisiyle değiştir
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'mail_list_detail' mail_list.id %}" class="btn btn-secondary me-md-2">İptal</a>
                        <button type="submit" class="btn btn-primary" id="importButton">
                            <i class="fas fa-upload me-2"></i>İçe Aktar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow">
            <div class="card-header">
                <h5 class="card-title mb-0">CSV Formatı</h5>
            </div>
            <div class="card-body">
                <p class="card-text">CSV dosyanız şu formatta olmalı:</p>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>email</th>
                                <th>name</th>
                                <th>phone</th>
                                <th>company</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ornek1@email.com</td>
                                <td>Ahmet Yılmaz</td>
                                <td>0555 123 45 67</td>
                                <td>ABC Şirketi</td>
                            </tr>
                            <tr>
                                <td>ornek2@email.com</td>
                                <td>Ayşe Demir</td>
                                <td></td>
                                <td>XYZ Ltd.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <a href="#" class="btn btn-outline-secondary btn-sm w-100">
                    <i class="fas fa-download me-2"></i>Örnek CSV İndir
                </a>
            </div>
        </div>
        
        <div class="card border-0 shadow mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">İpuçları</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        UTF-8 kodlamasını kullanın
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        E-posta sütunu zorunludur
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Geçersiz e-postalar atlanacak
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Maksimum 10.000 kayıt ekleyebilirsiniz
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
document.getElementById('importForm').addEventListener('submit', function() {
    const button = document.getElementById('importButton');
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>İşleniyor...';
});
</script>
{% endblock %}
{% endblock %}